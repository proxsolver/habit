<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ì¡± ë£¨í‹´ íŠ¸ë˜ì»¤</title>
    <style>
        /* ì „ì—­ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --accent: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --success: #10b981;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: var(--text-primary);
            font-size: 16px;
            line-height: 1.6;
        }
        .container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background: #ffffff;
            position: relative;
            overflow-x: hidden;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.1);
        }
        /* ì• ë‹ˆë©”ì´ì…˜ í‚¤í”„ë ˆì„ */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
            40%, 43% { transform: translateY(-8px); }
            70% { transform: translateY(-4px); }
            90% { transform: translateY(-2px); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
        /* ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ */
        .skeleton {
            background: linear-gradient(90deg, var(--gray-200) 25%, var(--gray-100) 50%, var(--gray-200) 75%);
            background-size: 200px 100%;
            animation: shimmer 2s infinite;
        }
        /* ë¡œê·¸ì¸ í˜ì´ì§€ */
        .login-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            animation: fadeInUp 0.8s ease-out;
        }
        .login-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 2.5rem 2rem;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 380px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideInRight 0.8s ease-out 0.2s both;
        }
        .app-title {
            text-align: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 2rem;
            letter-spacing: -0.02em;
        }
        .role-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .role-btn {
            padding: 1rem 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }
        .role-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            transition: left 0.5s;
        }
        .role-btn:hover::before {
            left: 100%;
        }
        .role-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        .role-btn.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        .input-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.875rem;
        }
        .input-group input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
        }
        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            transform: translateY(-1px);
        }
        .btn {
            width: 100%;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .btn:hover::before {
            left: 100%;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }
        .family-code-input {
            display: none;
            animation: fadeInUp 0.3s ease-out;
        }
        .family-code-display {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));
            padding: 1.5rem;
            border-radius: var(--radius);
            text-align: center;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(99, 102, 241, 0.2);
            animation: pulse 2s infinite;
        }
        .family-code {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 3px;
            font-family: 'Courier New', monospace;
        }
        /* Google ë¡œê·¸ì¸ ë²„íŠ¼ */
        .google-btn {
            background: white;
            color: var(--text-primary);
            border: 2px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .google-btn:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
            box-shadow: var(--shadow-lg);
        }
        .google-icon {
            width: 1.25rem;
            height: 1.25rem;
        }
        /* êµ¬ë¶„ì„  */
        .divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--gray-200);
        }
        .divider span {
            padding: 0 1rem;
            background: white;
        }
        /* ì´ë©”ì¼ ë¡œê·¸ì¸ ì„¹ì…˜ */
        .email-login-section {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 500px;
            overflow: hidden;
        }
        .email-login-section.collapsed {
            max-height: 0;
            margin: 0;
        }
        .btn-text {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            padding: 0.75rem;
            margin-top: 0.5rem;
            border-radius: var(--radius);
            transition: all 0.3s;
        }
        .btn-text:hover {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-dark);
        }
        /* ë©”ì¸ ì•± */
        .main-app {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2rem 1.5rem 3rem;
            text-align: center;
            position: relative;
            border-radius: 0 0 2rem 2rem;
        }
        .header::before {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 0 0 2rem 2rem;
            transform: scaleY(0.5);
            opacity: 0.3;
        }
        .user-info {
            position: absolute;
            right: 1.5rem;
            top: 1.5rem;
            font-size: 0.875rem;
            text-align: right;
        }
        .user-role {
            display: block;
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 0.25rem;
        }
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
            transition: all 0.3s;
        }
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        .header h1 {
            font-size: 1.75rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }
        #currentDate {
            opacity: 0.9;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .sleep-info {
            background: white;
            margin: -2rem 1.5rem 1.5rem;
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            text-align: center;
            position: relative;
            z-index: 10;
            border: 1px solid rgba(99, 102, 241, 0.1);
        }
        .sleep-hours {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }
        .sleep-info p {
            color: var(--text-secondary);
            font-weight: 500;
        }
        .quote {
            background: linear-gradient(135deg, var(--gray-50), white);
            margin: 0 1.5rem 1.5rem;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--primary);
            font-style: italic;
            text-align: center;
            box-shadow: var(--shadow);
            position: relative;
        }
        .quote::before {
            content: '"';
            position: absolute;
            top: -0.5rem;
            left: 1rem;
            font-size: 3rem;
            color: var(--primary);
            opacity: 0.3;
        }
        .routine-list {
            padding: 0 1.5rem 8rem;
        }
        .routine-item {
            background: white;
            margin-bottom: 1rem;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--gray-100);
            animation: fadeInUp 0.6s ease-out;
        }
        .routine-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        .routine-title {
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-size: 1.125rem;
        }
        .routine-controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        .time-input, .number-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all 0.3s;
        }
        .time-input:focus, .number-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        .number-input {
            text-align: center;
            font-weight: 600;
        }
        .yes-no-btns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            flex: 1;
        }
        .yes-btn, .no-btn {
            padding: 0.875rem;
            border: none;
            border-radius: var(--radius);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.875rem;
            position: relative;
            overflow: hidden;
        }
        .yes-btn {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 2px solid rgba(16, 185, 129, 0.2);
        }
        .yes-btn:hover {
            background: rgba(16, 185, 129, 0.2);
            transform: translateY(-1px);
        }
        .yes-btn.active {
            background: var(--success);
            color: white;
            box-shadow: var(--shadow-md);
            animation: bounce 0.6s ease-out;
        }
        .no-btn {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
            border: 2px solid rgba(239, 68, 68, 0.2);
        }
        .no-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: translateY(-1px);
        }
        .no-btn.active {
            background: var(--error);
            color: white;
            box-shadow: var(--shadow-md);
            animation: bounce 0.6s ease-out;
        }
        /* ê°€ì¡± ì½”ë“œ ì¹´ë“œ */
        .family-code-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            margin: 1.5rem;
            padding: 2rem;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        .family-code-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s infinite;
        }
        .card-header h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.5rem;
            font-weight: 800;
            position: relative;
            z-index: 1;
        }
        .card-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
        }
        .family-code-display-main {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 1;
        }
        .family-code-large {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: 4px;
            margin-bottom: 1rem;
            font-family: 'Courier New', monospace;
        }
        .copy-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .family-info {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .info-item:last-child {
            border-bottom: none;
        }
        .info-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        .info-value {
            font-size: 0.875rem;
            font-weight: 700;
        }
        /* í˜ì´ì§€ */
        .page {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }
        .family-page, .manage-page {
            padding: 1.5rem;
        }
        .page-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            text-align: center;
            letter-spacing: -0.02em;
        }
        .add-routine-btn {
            width: 100%;
            padding: 1.25rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .add-routine-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        .add-routine-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .add-routine-btn:hover::before {
            left: 100%;
        }
        /* ê°€ì¡± êµ¬ì„±ì› */
        .family-members {
            margin-bottom: 2rem;
        }
        .member-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--gray-100);
        }
        .member-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        .member-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .member-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .member-name {
            font-weight: 700;
            font-size: 1.125rem;
            color: var(--text-primary);
        }
        .member-role {
            font-size: 0.75rem;
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .member-status {
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .member-status.online {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        .member-status.offline {
            background: var(--gray-100);
            color: var(--gray-500);
        }
        .routine-progress {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .routine-badge {
            padding: 0.5rem 0.75rem;
            border-radius: 1.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .routine-badge.completed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        .routine-badge.pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        .routine-badge.skipped {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }
        /* ì•Œë¦¼ */
        .notification {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            max-width: 300px;
        }
        .notification.error {
            background: var(--error);
        }
        .notification.warning {
            background: var(--warning);
        }
        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--gray-200);
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            padding: 0.75rem 0 calc(0.75rem + env(safe-area-inset-bottom));
            border-radius: 1.5rem 1.5rem 0 0;
        }
        .nav-item {
            text-align: center;
            padding: 0.75rem 0.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-400);
            border-radius: var(--radius);
            margin: 0 0.25rem;
        }
        .nav-item:hover {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
        }
        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .nav-item i {
            display: block;
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
            font-style: normal;
        }
        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            animation: fadeInUp 0.3s ease-out;
        }
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 420px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideInRight 0.3s ease-out;
        }
        .modal-header {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--text-primary);
        }
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1.25rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-400);
            transition: all 0.3s;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-btn:hover {
            background: var(--gray-100);
            color: var(--gray-600);
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .form-group select,
        .form-group input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all 0.3s;
        }
        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-top: 2rem;
        }
        .btn-cancel {
            background: var(--gray-100);
            color: var(--gray-600);
        }
        .btn-cancel:hover {
            background: var(--gray-200);
        }
        /* ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .hidden {
            display: none !important;
        }
        .text-center {
            text-align: center;
        }
        .font-bold {
            font-weight: 700;
        }
        .text-sm {
            font-size: 0.875rem;
        }
        .text-xs {
            font-size: 0.75rem;
        }
        .mb-4 {
            margin-bottom: 1rem;
        }
        .p-4 {
            padding: 1rem;
        }
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 480px) {
            .container {
                max-width: 100%;
                margin: 0;
            }
            .bottom-nav {
                max-width: 100%;
                left: 0;
                transform: none;
            }
            .login-form {
                margin: 1rem;
                padding: 2rem 1.5rem;
            }
            .header {
                padding: 1.5rem 1rem 2.5rem;
            }
            .user-info {
                right: 1rem;
                top: 1rem;
            }
            .sleep-info {
                margin: -1.5rem 1rem 1rem;
                padding: 1.5rem;
            }
            .quote, .routine-list {
                margin-left: 1rem;
                margin-right: 1rem;
            }
            .family-code-card {
                margin: 1rem;
                padding: 1.5rem;
            }
            .notification {
                top: 1rem;
                right: 1rem;
                left: 1rem;
                max-width: none;
            }
        }
        /* ë‹¤í¬ ëª¨ë“œ ì¤€ë¹„ */
        @media (prefers-color-scheme: dark) {
            /* ë‚˜ì¤‘ì— ë‹¤í¬ ëª¨ë“œ êµ¬í˜„ ì‹œ ì‚¬ìš© */
        }
        /* í”„ë¦°íŠ¸ ìŠ¤íƒ€ì¼ */
        @media print {
            .bottom-nav,
            .logout-btn,
            .add-routine-btn {
                display: none;
            }
        }
        /* ì ‘ê·¼ì„± ê°œì„  */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        /* í„°ì¹˜ ë””ë°”ì´ìŠ¤ ìµœì í™” */
        @media (pointer: coarse) {
            .btn,
            .nav-item,
            .role-btn,
            .yes-btn,
            .no-btn {
                min-height: 44px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
        <div id="loginPage" class="login-page">
            <div class="login-form">
                <h1 class="app-title">ğŸŒ… ë£¨í‹´ íŠ¸ë˜ì»¤</h1>
                <!-- ì—­í•  ì„ íƒ -->
                <div class="role-selector">
                    <div class="role-btn active" onclick="window.selectRole('parent', event)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ë¶€ëª¨</div>
                    <div class="role-btn" onclick="window.selectRole('child', event)">ğŸ‘¶ ìë…€</div>
                </div>
                <!-- ê°€ì¡± ì½”ë“œ ì…ë ¥ (ìë…€ìš©) -->
                <div id="familyCodeInput" class="input-group family-code-input">
                    <label for="familyCode">ê°€ì¡± ì½”ë“œ</label>
                    <input type="text" id="familyCode" placeholder="ê°€ì¡± ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <!-- Google ë¡œê·¸ì¸ ë²„íŠ¼ -->
                <button class="btn google-btn" onclick="window.signInWithGoogle()">
                    <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="google-icon">
                    Googleë¡œ ì‹œì‘í•˜ê¸°
                </button>
                <!-- êµ¬ë¶„ì„  -->
                <div class="divider">
                    <span>ë˜ëŠ”</span>
                </div>
                <!-- ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ (ì„ íƒì‚¬í•­) -->
                <div class="email-login-section collapsed" id="emailLoginSection">
                    <div class="input-group">
                        <label for="email">ì´ë©”ì¼</label>
                        <input type="email" id="email" placeholder="your@email.com">
                    </div>
                    <div class="input-group">
                        <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                    </div>
                    <button class="btn" id="loginBtn" onclick="window.handleAuth('login')">ë¡œê·¸ì¸</button>
                    <button class="btn btn-secondary" onclick="window.handleAuth('register')">íšŒì›ê°€ì…</button>
                </div>
                <button class="btn-text" onclick="window.toggleEmailLogin()">ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸</button>
                <!-- ê°€ì¡± ì½”ë“œ í‘œì‹œ (ë¶€ëª¨ìš© íšŒì›ê°€ì… í›„) -->
                <div id="familyCodeDisplay" class="family-code-display hidden">
                    <div>ê°€ì¡± ì½”ë“œ</div>
                    <div class="family-code" id="generatedFamilyCode"></div>
                    <div style="font-size: 0.75rem; margin-top: 0.75rem; color: var(--text-secondary);">
                        ìë…€ì—ê²Œ ì´ ì½”ë“œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”
                    </div>
                </div>
            </div>
        </div>
        <!-- ë©”ì¸ ì•± -->
        <div id="mainApp" class="main-app">
            <!-- í—¤ë” -->
            <div class="header">
                <div class="user-info">
                    <span id="userEmail"></span>
                    <span class="user-role" id="userRole"></span>
                    <span class="user-id-display text-xs" id="currentUserId"></span> <!-- userId í‘œì‹œ ì¶”ê°€ -->
                    <button class="logout-btn" onclick="window.logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
                <h1>ì˜¤ëŠ˜ì˜ ë£¨í‹´</h1>
                <div id="currentDate"></div>
            </div>
            <!-- ë©”ì¸ í˜ì´ì§€ -->
            <div id="homePage" class="page">
                <!-- ìˆ˜ë©´ ì •ë³´ -->
                <div class="sleep-info">
                    <div class="sleep-hours" id="sleepHours">-</div>
                    <div>ì–´ì ¯ë°¤ ìˆ˜ë©´ì‹œê°„</div>
                </div>
                <!-- ì˜¤ëŠ˜ì˜ ëª…ì–¸ -->
                <div class="quote" id="dailyQuote">
                    "ì„±ê³µì€ ë§¤ì¼ì˜ ì‘ì€ ë…¸ë ¥ë“¤ì´ ìŒ“ì—¬ì„œ ë§Œë“¤ì–´ì§„ë‹¤."
                </div>
                <!-- ë£¨í‹´ ëª©ë¡ -->
                <div class="routine-list" id="routineList">
                    <!-- ë£¨í‹´ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
            <!-- ê°€ì¡± í˜ì´ì§€ -->
            <div id="familyPage" class="page family-page">
                <div class="page-title">ê°€ì¡± ë£¨í‹´ í˜„í™©</div>
                <!-- ê°€ì¡± ì½”ë“œ í‘œì‹œ ì¹´ë“œ (ë¶€ëª¨ë§Œ) -->
                <div id="familyCodeCard" class="family-code-card hidden">
                    <div class="card-header">
                        <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì½”ë“œ</h3>
                        <div class="card-subtitle">ìë…€ë“¤ì´ ê°€ì¡±ì— ì°¸ì—¬í•  ë•Œ í•„ìš”í•œ ì½”ë“œì…ë‹ˆë‹¤</div>
                    </div>
                    <div class="family-code-display-main">
                        <div class="family-code-large" id="familyCodeMain">-</div>
                        <button class="copy-btn" onclick="window.copyFamilyCode()">ğŸ“‹ ë³µì‚¬</button>
                    </div>
                    <div class="family-info">
                        <div class="info-item">
                            <span class="info-label">ê°€ì¡± êµ¬ì„±ì›:</span>
                            <span class="info-value" id="memberCount">-ëª…</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ìƒì„±ì¼:</span>
                            <span class="info-value" id="familyCreatedDate">-</span>
                        </div>
                    </div>
                </div>
                <!-- ê°€ì¡± êµ¬ì„±ì› ëª©ë¡ -->
                <div id="familyMembers" class="family-members">
                    <!-- ê°€ì¡± êµ¬ì„±ì›ë“¤ì˜ ë£¨í‹´ í˜„í™© -->
                </div>
            </div>
            <!-- ê´€ë¦¬ í˜ì´ì§€ -->
            <div id="managePage" class="page manage-page">
                <div class="page-title">ë£¨í‹´ ê´€ë¦¬</div>
                <button class="add-routine-btn" onclick="window.openAddRoutineModal()">âœ¨ ìƒˆ ë£¨í‹´ ì¶”ê°€</button>
                <div id="manageRoutineList">
                    <!-- ê´€ë¦¬ìš© ë£¨í‹´ ëª©ë¡ -->
                </div>
            </div>
            <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="bottom-nav">
                <div class="nav-item active" onclick="window.showPage('home')">
                    <i>ğŸ </i>
                    <span>í™ˆ</span>
                </div>
                <div class="nav-item" onclick="window.showPage('manage')">
                    <i>âš™ï¸</i>
                    <span>ê´€ë¦¬</span>
                </div>
                <div class="nav-item" onclick="window.showPage('review')">
                    <i>ğŸ“Š</i>
                    <span>ë¦¬ë·°</span>
                </div>
                <div class="nav-item" onclick="window.showPage('stats')">
                    <i>ğŸ“ˆ</i>
                    <span>í†µê³„</span>
                </div>
                <div class="nav-item" onclick="window.showPage('family')">
                    <i>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</i>
                    <span>ê°€ì¡±</span>
                </div>
            </div>
        </div>
        <!-- ë£¨í‹´ ì¶”ê°€ ëª¨ë‹¬ -->
        <div id="addRoutineModal" class="modal">
            <div class="modal-content">
                <button class="close-btn" onclick="window.closeModal()">&times;</button>
                <div class="modal-header">âœ¨ ìƒˆ ë£¨í‹´ ì¶”ê°€</div>
                <div class="form-group">
                    <label for="routineName">ë£¨í‹´ ì´ë¦„</label>
                    <input type="text" id="routineName" placeholder="ë£¨í‹´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label for="routineType">ë£¨í‹´ íƒ€ì…</label>
                    <select id="routineType">
                        <option value="yesno">ì˜ˆ/ì•„ë‹ˆì˜¤</option>
                        <option value="number">ìˆ«ì ì…ë ¥</option>
                        <option value="time">ì‹œê°„ ì…ë ¥</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="routineTime">ì‹œì </label>
                    <select id="routineTime">
                        <option value="morning">ğŸŒ… ì•„ì¹¨</option>
                        <option value="afternoon">ğŸŒ ì ì‹¬</option>
                        <option value="evening">ğŸŒ™ ì €ë…</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="routineFreq">ì£¼ê¸°</label>
                    <select id="routineFreq">
                        <option value="daily">ë§¤ì¼</option>
                        <option value="weekday">í‰ì¼</option>
                        <option value="weekend">ì£¼ë§</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button class="btn btn-cancel" onclick="window.closeModal()">ì·¨ì†Œ</button>
                    <button class="btn" onclick="window.addRoutine()">ì¶”ê°€</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Firebase SDKs (Updated to v11.6.1) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, where, addDoc, getDocs, FieldValue, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // Firebase ì„¤ì • (Canvas í™˜ê²½ì—ì„œ ì œê³µë˜ëŠ” ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        let userRole = 'parent'; // ê¸°ë³¸ê°’ ì„¤ì •
        let familyId = null;
        let routines = [];
        let familyMembers = [];
        let auth, db;
        let currentUserId = null; // í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ UID
        // ê¸°ë³¸ ëª…ì–¸ë“¤
        const quotes = [
            "ì„±ê³µì€ ë§¤ì¼ì˜ ì‘ì€ ë…¸ë ¥ë“¤ì´ ìŒ“ì—¬ì„œ ë§Œë“¤ì–´ì§„ë‹¤.",
            "ì˜¤ëŠ˜ í•˜ë£¨ë„ ìµœì„ ì„ ë‹¤í•˜ëŠ” í•˜ë£¨ê°€ ë˜ê¸¸.",
            "ì‘ì€ ìŠµê´€ì´ í° ë³€í™”ë¥¼ ë§Œë“ ë‹¤.",
            "ê¾¸ì¤€í•¨ì´ ì²œì¬ë¥¼ ì´ê¸´ë‹¤.",
            "ë§¤ì¼ ì¡°ê¸ˆì”© ë‚˜ì•„ì§€ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.",
            "ëª©í‘œë¥¼ í–¥í•œ ì²« ê±¸ìŒì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤.",
            "ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ì‹œì‘í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.",
            "ì˜¤ëŠ˜ì˜ ë‚˜ëŠ” ì–´ì œì˜ ë‚˜ë³´ë‹¤ ì¡°ê¸ˆ ë” ë‚˜ì€ ì‚¬ëŒì´ë‹¤.",
            "ë£¨í‹´ì€ ê¿ˆì„ í˜„ì‹¤ë¡œ ë§Œë“œëŠ” ë‹¤ë¦¬ë‹¤.",
            "ì‘ì€ ì‹¤ì²œì´ í° ê¸°ì ì„ ë§Œë“ ë‹¤."
        ];
        // Firebase ì´ˆê¸°í™”
        async function initializeFirebase() {
            try {
                console.log('ğŸ”¥ Firebase ì´ˆê¸°í™” ì‹œì‘...');
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                // Canvas í™˜ê²½ì˜ ì´ˆê¸° ì¸ì¦ í† í° ì‚¬ìš©
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log('âœ… Custom Tokenìœ¼ë¡œ ë¡œê·¸ì¸ ì„±ê³µ!');
                } else {
                    await signInAnonymously(auth);
                    console.log('âœ… ìµëª… ë¡œê·¸ì¸ ì„±ê³µ!');
                }
                console.log('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ!');
                console.log('ğŸ”¥ Auth:', auth);
                console.log('ğŸ—ƒï¸ DB:', db);
                // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUser = user;
                        currentUserId = user.uid; // ì‚¬ìš©ì UID ì„¤ì •
                        await loadUserProfile();
                        showMainApp();
                        startRealtimeListeners();
                    } else {
                        currentUser = null;
                        currentUserId = null;
                        showLoginPage();
                    }
                });
                return true;
            } catch (error) {
                console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showNotification('Firebase ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                return false;
            }
        }
        // ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±° í•¨ìˆ˜ë“¤
        function triggerAnimation(element, animationClass) {
            element.classList.add(animationClass);
            setTimeout(() => {
                element.classList.remove(animationClass);
            }, 600);
        }
        function addRippleEffect(button, event) {
            const ripple = document.createElement('span');
            const rect = button.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = event.clientX - rect.left - size / 2;
            const y = event.clientY - rect.top - size / 2;
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.classList.add('ripple');
            button.appendChild(ripple);
            setTimeout(() => {
                ripple.remove();
            }, 600);
        }
        // ì—­í•  ì„ íƒ
        function selectRole(role, event) {
            userRole = role;
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active'); // event.currentTarget ì‚¬ìš©
            const familyCodeInput = document.getElementById('familyCodeInput');
            if (role === 'child') {
                familyCodeInput.style.display = 'block';
                familyCodeInput.style.animation = 'fadeInUp 0.3s ease-out';
            } else {
                familyCodeInput.style.display = 'none';
            }
        }
        // Make selectRole globally accessible
        window.selectRole = selectRole;
        // Google ë¡œê·¸ì¸
        async function signInWithGoogle() {
            const familyCode = document.getElementById('familyCode').value;
            if (userRole === 'child' && !familyCode) {
                showNotification('ìë…€ëŠ” ê°€ì¡± ì½”ë“œë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            if (!auth) {
                showNotification('Firebaseê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            setLoading(true, 'google');
            try {
                const provider = new GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                // ê¸°ì¡´ ì‚¬ìš©ìì¸ì§€ í™•ì¸
                const userDocRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile/data`);
                const userDoc = await getDoc(userDocRef);
                if (!userDoc.exists()) {
                    // ìƒˆ ì‚¬ìš©ìë¼ë©´ í”„ë¡œí•„ ìƒì„±
                    await createUserProfile(user, familyCode);
                    showNotification('Google ê³„ì •ìœ¼ë¡œ ì„±ê³µì ìœ¼ë¡œ ê°€ì…ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
                } else {
                    // ê¸°ì¡´ ì‚¬ìš©ìë¼ë©´ ë¡œê·¸ì¸
                    showNotification('Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‘‹');
                }
            } catch (error) {
                console.error('Google ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                if (error.code === 'auth/popup-closed-by-user') {
                    showNotification('ë¡œê·¸ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                } else if (error.code === 'auth/popup-blocked') {
                    showNotification('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.', 'error');
                } else {
                    showNotification('Google ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } finally {
                setLoading(false, 'google');
            }
        }
        // Make signInWithGoogle globally accessible
        window.signInWithGoogle = signInWithGoogle;
        // ì´ë©”ì¼ ë¡œê·¸ì¸ í† ê¸€
        function toggleEmailLogin() {
            const section = document.getElementById('emailLoginSection');
            const button = event.target;
            if (section.classList.contains('collapsed')) {
                section.classList.remove('collapsed');
                button.textContent = 'ê°„í¸ ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°';
            } else {
                section.classList.add('collapsed');
                button.textContent = 'ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸';
            }
        }
        // Make toggleEmailLogin globally accessible
        window.toggleEmailLogin = toggleEmailLogin;
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function generateFamilyCode() {
            return Math.random().toString(36).substr(2, 8).toUpperCase();
        }
        function showNotification(message, type = 'success') {
            // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            // ìë™ ì œê±°
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out forwards';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 4000);
        }
        function setLoading(loading, type = 'email') {
            if (type === 'google') {
                const googleBtn = document.querySelector('.google-btn');
                if (googleBtn) {
                    if (loading) {
                        googleBtn.disabled = true;
                        googleBtn.innerHTML = `
                            <div style="width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            Google ë¡œê·¸ì¸ ì¤‘...
                        `;
                    } else {
                        googleBtn.disabled = false;
                        googleBtn.innerHTML = `
                            <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="google-icon">
                            Googleë¡œ ì‹œì‘í•˜ê¸°
                        `;
                    }
                }
            } else { // For email login/register buttons
                const loginBtn = document.getElementById('loginBtn');
                const registerBtn = document.querySelector('.btn-secondary');
                if (loginBtn) loginBtn.disabled = loading;
                if (registerBtn) registerBtn.disabled = loading;
            }
        }
        function showLoginPage() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }
        function showMainApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            // ë©”ì¸ ì•± í‘œì‹œ ì‹œ ì• ë‹ˆë©”ì´ì…˜
            const mainApp = document.getElementById('mainApp');
            mainApp.style.animation = 'fadeInUp 0.6s ease-out';
        }
        // í˜„ì¬ ë‚ ì§œ ì—…ë°ì´íŠ¸
        function updateCurrentDate() {
            const today = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            };
            document.getElementById('currentDate').textContent =
                today.toLocaleDateString('ko-KR', options);
        }
        // ì¼ì¼ ëª…ì–¸ ì—…ë°ì´íŠ¸
        function updateDailyQuote() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            const quoteIndex = dayOfYear % quotes.length;
            document.getElementById('dailyQuote').textContent = quotes[quoteIndex];
        }
        // í˜ì´ì§€ ì „í™˜
        function showPage(page) {
            // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.page').forEach(p => {
                p.style.display = 'none';
            });
            // ëª¨ë“  ë„¤ë¹„ê²Œì´ì…˜ í•­ëª© ë¹„í™œì„±í™”
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            // ì„ íƒëœ í˜ì´ì§€ ë° ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™”
            if (page === 'home') {
                document.getElementById('homePage').style.display = 'block';
                document.querySelectorAll('.nav-item')[0].classList.add('active');
                loadRoutinesForDisplay(); // í™ˆ í˜ì´ì§€ ë£¨í‹´ ë¡œë“œ
            } else if (page === 'manage') {
                document.getElementById('managePage').style.display = 'block';
                document.querySelectorAll('.nav-item')[1].classList.add('active');
                loadUserRoutines(); // ê´€ë¦¬ í˜ì´ì§€ ë£¨í‹´ ë¡œë“œ
            } else if (page === 'family') {
                document.getElementById('familyPage').style.display = 'block';
                document.querySelectorAll('.nav-item')[4].classList.add('active');
                loadFamilyPageInfo();
            } else if (page === 'review') {
                showNotification('ğŸ“Š ë¦¬ë·° í˜ì´ì§€ëŠ” ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!', 'warning');
            } else if (page === 'stats') {
                showNotification('ğŸ“ˆ í†µê³„ í˜ì´ì§€ëŠ” ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!', 'warning');
            }
            // í˜ì´ì§€ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜
            const activePage = document.querySelector('.page[style*="block"]');
            if (activePage) {
                activePage.style.animation = 'fadeInUp 0.4s ease-out';
            }
        }
        // Make showPage globally accessible
        window.showPage = showPage;
        // ê°€ì¡± í˜ì´ì§€ ì •ë³´ ë¡œë“œ
        async function loadFamilyPageInfo() {
            console.log('ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± í˜ì´ì§€ ì •ë³´ ë¡œë“œ');
            if (!currentUser || !familyId) {
                console.log('âŒ ì‚¬ìš©ì ë˜ëŠ” ê°€ì¡± ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            try {
                // ë¶€ëª¨ì¸ ê²½ìš° ê°€ì¡± ì½”ë“œ ì¹´ë“œ í‘œì‹œ
                if (userRole === 'parent') {
                    const familyDocRef = doc(db, `artifacts/${appId}/public/data/families/${familyId}`);
                    const familyDoc = await getDoc(familyDocRef);
                    if (familyDoc.exists()) {
                        const familyData = familyDoc.data();
                        const familyCode = familyData.familyCode || familyId;
                        const memberCount = familyData.members ? familyData.members.length : 1;
                        const createdDate = familyData.createdAt ? familyData.createdAt.toDate().toLocaleDateString('ko-KR') : '-';
                        console.log('ğŸ“‹ ê°€ì¡± ì •ë³´:', { familyCode, memberCount, createdDate });
                        // ê°€ì¡± ì½”ë“œ ì¹´ë“œ í‘œì‹œ
                        const familyCodeCard = document.getElementById('familyCodeCard');
                        const familyCodeMain = document.getElementById('familyCodeMain');
                        const memberCountEl = document.getElementById('memberCount');
                        const familyCreatedDateEl = document.getElementById('familyCreatedDate');
                        if (familyCodeCard && familyCodeMain) {
                            familyCodeMain.textContent = familyCode;
                            if (memberCountEl) memberCountEl.textContent = `${memberCount}ëª…`;
                            if (familyCreatedDateEl) familyCreatedDateEl.textContent = createdDate;
                            familyCodeCard.classList.remove('hidden');
                            familyCodeCard.style.display = 'block';
                            console.log('âœ… ê°€ì¡± ì½”ë“œ ì¹´ë“œ í‘œì‹œ ì™„ë£Œ');
                        }
                        // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (ë³µì‚¬ ê¸°ëŠ¥ìš©)
                        window.currentFamilyCode = familyCode;
                    }
                } else {
                    // ìë…€ì¸ ê²½ìš° ê°€ì¡± ì½”ë“œ ì¹´ë“œ ìˆ¨ê¸°ê¸°
                    const familyCodeCard = document.getElementById('familyCodeCard');
                    if (familyCodeCard) {
                        familyCodeCard.classList.add('hidden');
                        familyCodeCard.style.display = 'none';
                    }
                }
                // ê°€ì¡± êµ¬ì„±ì› ì •ë³´ ë¡œë“œ
                await loadFamilyMembers();
            } catch (error) {
                console.error('âŒ ê°€ì¡± í˜ì´ì§€ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        // ê°€ì¡± êµ¬ì„±ì› ë¡œë“œ
        async function loadFamilyMembers() {
            if (!familyId) return;
            try {
                const familyDocRef = doc(db, `artifacts/${appId}/public/data/families/${familyId}`);
                const familyDoc = await getDoc(familyDocRef);
                if (!familyDoc.exists()) return;
                const familyData = familyDoc.data();
                const memberIds = familyData.members || [];
                const familyMembersContainer = document.getElementById('familyMembers');
                familyMembersContainer.innerHTML = '';
                for (const memberId of memberIds) {
                    const memberDocRef = doc(db, `artifacts/${appId}/users/${memberId}/profile/data`);
                    const memberDoc = await getDoc(memberDocRef);
                    if (memberDoc.exists()) {
                        const memberData = memberDoc.data();
                        const memberCard = createMemberCard(memberData, memberId);
                        familyMembersContainer.appendChild(memberCard);
                    }
                }
            } catch (error) {
                console.error('âŒ ê°€ì¡± êµ¬ì„±ì› ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        // ê°€ì¡± êµ¬ì„±ì› ì¹´ë“œ ìƒì„±
        function createMemberCard(memberData, memberId) {
            const card = document.createElement('div');
            card.className = 'member-card';
            const displayName = memberData.displayName || memberData.email.split('@')[0];
            const role = memberData.role === 'parent' ? 'ë¶€ëª¨' : 'ìë…€';
            const isOnline = memberId === currentUser?.uid;
            card.innerHTML = `
                <div class="member-header">
                    <div class="member-info">
                        <div class="member-name">${displayName}</div>
                        <div class="member-role">${role}</div>
                    </div>
                    <div class="member-status ${isOnline ? 'online' : 'offline'}">
                        ${isOnline ? 'ONLINE' : 'OFFLINE'}
                    </div>
                </div>
                <div class="routine-progress">
                    <!-- TODO: ì‹¤ì œ ë£¨í‹´ ì§„í–‰ ìƒí™©ì„ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œ -->
                    <div class="routine-badge completed">ìš´ë™ ì™„ë£Œ</div>
                    <div class="routine-badge pending">ë¬¼ë§ˆì‹œê¸° ëŒ€ê¸°</div>
                    <div class="routine-badge completed">ìˆ˜ë©´ì‹œê°„ ê¸°ë¡</div>
                </div>
            `;
            return card;
        }
        // ê°€ì¡± ì½”ë“œ ë³µì‚¬ - ìˆ˜ì •ë¨: navigator.clipboard ì‚¬ìš©
        async function copyFamilyCode() {
            const familyCode = window.currentFamilyCode || document.getElementById('familyCodeMain').textContent;
            if (!familyCode || familyCode === '-') {
                showNotification('ë³µì‚¬í•  ê°€ì¡± ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            try {
                // Modern clipboard API
                await navigator.clipboard.writeText(familyCode);
                showNotification(`ğŸ‰ ê°€ì¡± ì½”ë“œ "${familyCode}"ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                // ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜
                const copyBtn = document.querySelector('.copy-btn');
                if (copyBtn) {
                    const originalText = copyBtn.textContent;
                    copyBtn.textContent = 'âœ… ë³µì‚¬ë¨!';
                    copyBtn.style.background = 'rgba(16, 185, 129, 0.3)';
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.style.background = 'rgba(255, 255, 255, 0.2)';
                    }, 2000);
                }
            } catch (error) {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨ (Modern API):', error);
                // í´ë°±: ë ˆê±°ì‹œ ë°©ë²• ì‚¬ìš©
                try {
                    const tempInput = document.createElement('textarea');
                    tempInput.value = familyCode;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    showNotification(`ğŸ‰ ê°€ì¡± ì½”ë“œ "${familyCode}"ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                } catch (fallbackErr) {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨ (Legacy Fallback):', fallbackErr);
                    showNotification('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.', 'error');
                }
            }
        }
        // Make copyFamilyCode globally accessible
        window.copyFamilyCode = copyFamilyCode;
        // ì¸ì¦ ì²˜ë¦¬ (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸)
        async function handleAuth(type) {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const familyCode = document.getElementById('familyCode').value;
            if (!email || !password) {
                showNotification('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            if (userRole === 'child' && type === 'register' && !familyCode) {
                showNotification('ê°€ì¡± ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            setLoading(true, 'email');
            try {
                let userCredential;
                if (type === 'login') {
                    userCredential = await signInWithEmailAndPassword(auth, email, password);
                } else {
                    userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await createUserProfile(userCredential.user, familyCode);
                }
                showNotification('âœ¨ ì„±ê³µì ìœ¼ë¡œ ' + (type === 'login' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…') + 'ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('ì¸ì¦ ì˜¤ë¥˜:', error);
                // ìë…€ ê³„ì • ìƒì„± ì˜¤ë¥˜ì— ëŒ€í•œ ë” êµ¬ì²´ì ì¸ ë©”ì‹œì§€
                if (userRole === 'child' && type === 'register' && error.message.includes('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°€ì¡± ì½”ë“œì…ë‹ˆë‹¤.')) {
                    showNotification('ì…ë ¥í•˜ì‹  ê°€ì¡± ì½”ë“œê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                } else if (userRole === 'child' && type === 'register' && error.message.includes('ê°€ì¡± ì½”ë“œ í™•ì¸ ë˜ëŠ” ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ')) {
                    showNotification('ê°€ì¡± ì½”ë“œ í™•ì¸ ë˜ëŠ” ê°€ì¡± ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                } else {
                    showNotification('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
            } finally {
                setLoading(false, 'email');
            }
        }
        // Make handleAuth globally accessible
        window.handleAuth = handleAuth;
        // ì‚¬ìš©ì í”„ë¡œí•„ ìƒì„± - ìˆ˜ì •ë¨: Google í”„ë¡œí•„ ìƒì„± ë¡œì§ í†µí•© (ê¶Œì¥)
        async function createUserProfile(user, familyCode = null) {
            console.log('í”„ë¡œí•„ ìƒì„±:', user.email);
            const userProfileRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile/data`);
            let userData = {
                email: user.email,
                displayName: user.displayName || user.email.split('@')[0],
                photoURL: user.photoURL || '',
                role: userRole,
                authProvider: user.providerData[0]?.providerId || 'email', // ë™ì  ì œê³µì
                createdAt: FieldValue.serverTimestamp(),
                lastActive: FieldValue.serverTimestamp()
            };

            if (userRole === 'parent') {
                const newFamilyId = generateFamilyCode();
                userData.familyId = newFamilyId;
                userData.isParent = true;
                const familyDocRef = doc(db, `artifacts/${appId}/public/data/families/${newFamilyId}`);
                await setDoc(familyDocRef, {
                    parentId: user.uid,
                    parentName: userData.displayName,
                    members: [user.uid],
                    createdAt: FieldValue.serverTimestamp(),
                    familyCode: newFamilyId
                });
                // ê°€ì¡± ì½”ë“œ í‘œì‹œ
                setTimeout(() => {
                    const codeElement = document.getElementById('generatedFamilyCode');
                    const displayElement = document.getElementById('familyCodeDisplay');
                    if (codeElement && displayElement) {
                        codeElement.textContent = newFamilyId;
                        displayElement.classList.remove('hidden');
                        displayElement.style.display = 'block';
                        console.log('âœ… ê°€ì¡± ì½”ë“œ UI ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    }
                    showNotification(`ğŸ”‘ ê°€ì¡± ì½”ë“œ: ${newFamilyId}`);
                }, 1000);
            } else if (familyCode) {
                console.log(`Attempting to join family with code: ${familyCode}`);
                const familyDocRef = doc(db, `artifacts/${appId}/public/data/families/${familyCode}`);
                try {
                    const familyDoc = await getDoc(familyDocRef);
                    if (familyDoc.exists()) {
                        userData.familyId = familyCode;
                        userData.isParent = false;
                        await updateDoc(familyDocRef, {
                            members: FieldValue.arrayUnion(user.uid)
                        });
                        console.log(`Successfully added user ${user.uid} to family ${familyCode} members array.`);
                        showNotification(`ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±ì— ì„±ê³µì ìœ¼ë¡œ ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤! ì½”ë“œ: ${familyCode}`);
                    } else {
                        console.error(`Family code ${familyCode} does not exist.`);
                        throw new Error('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°€ì¡± ì½”ë“œì…ë‹ˆë‹¤.'); // ì´ ì˜¤ë¥˜ê°€ handleAuthë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
                    }
                } catch (familyError) {
                    console.error('Error checking or updating family document:', familyError);
                    throw new Error('ê°€ì¡± ì½”ë“œ í™•ì¸ ë˜ëŠ” ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + familyError.message);
                }
            } else {
                 // ìë…€ì¸ë° familyCodeê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜
                 throw new Error('ìë…€ ê³„ì • ìƒì„± ì‹œ ê°€ì¡± ì½”ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.');
            }
            await setDoc(userProfileRef, userData);
            console.log(`User profile for ${user.uid} set successfully.`);
            await createDefaultRoutines(user.uid, userData.familyId);
            console.log(`Default routines created for user ${user.uid}.`);
        }
        // ê¸°ë³¸ ë£¨í‹´ ìƒì„±
        async function createDefaultRoutines(userId, familyId) {
            const defaultRoutines = [
                { name: 'ğŸŒ™ ì·¨ì¹¨ ì‹œê°„', type: 'time', time: 'evening', frequency: 'daily', order: 1 },
                { name: 'ğŸŒ… ê¸°ìƒ ì‹œê°„', type: 'time', time: 'morning', frequency: 'daily', order: 2 },
                { name: 'ğŸ’ª ìš´ë™í•˜ê¸°', type: 'yesno', time: 'morning', frequency: 'daily', order: 3 },
                { name: 'ğŸ’§ ë¬¼ ë§ˆì‹œê¸° (ì”)', type: 'number', time: 'evening', frequency: 'daily', order: 4 }
            ];
            const batch = db.batch();
            defaultRoutines.forEach((routine) => {
                const routineRef = doc(collection(db, `artifacts/${appId}/users/${userId}/routines`));
                batch.set(routineRef, {
                    ...routine,
                    userId: userId,
                    familyId: familyId,
                    createdAt: FieldValue.serverTimestamp()
                });
            });
            await batch.commit();
        }
        // ë£¨í‹´ ì—…ë°ì´íŠ¸ - ìˆ˜ì •ë¨: event ë§¤ê°œë³€ìˆ˜ ì¶”ê°€
        async function updateRoutine(routineId, value, event) { // event ë§¤ê°œë³€ìˆ˜ ì¶”ê°€
            if (!currentUser) return;
            const today = new Date().toISOString().split('T')[0];
            const logDocRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/routine_logs/${routineId}_${today}`);
            const logData = {
                routineId: routineId,
                userId: currentUser.uid,
                familyId: familyId,
                value: value,
                completed: true,
                date: today,
                timestamp: FieldValue.serverTimestamp()
            };
            try {
                await setDoc(logDocRef, logData, { merge: true }); // merge: trueë¡œ ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•©
                showNotification('âœ… ë£¨í‹´ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
                // ì„±ê³µ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                if (event) { // eventê°€ ì œê³µë˜ì—ˆëŠ”ì§€ í™•ì¸
                    const targetElement = event.target;
                    if (targetElement && (targetElement.classList.contains('yes-btn') || targetElement.classList.contains('no-btn'))) {
                        triggerAnimation(targetElement, 'bounce');
                    }
                }
            } catch (error) {
                console.error('ë£¨í‹´ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                showNotification('ë£¨í‹´ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        // Make updateRoutine globally accessible
        window.updateRoutine = updateRoutine;
        // ë£¨í‹´ ì¶”ê°€
        async function addRoutine() {
            console.log('ğŸ”§ ë£¨í‹´ ì¶”ê°€ ì‹œì‘');
            if (!familyId && currentUser) {
                await loadUserProfile();
            }
            const nameInput = document.getElementById('routineName');
            const typeInput = document.getElementById('routineType');
            const timeInput = document.getElementById('routineTime');
            const freqInput = document.getElementById('routineFreq');
            if (!nameInput) {
                console.error('âŒ ë£¨í‹´ ì´ë¦„ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                showNotification('ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            const name = nameInput.value;
            const type = typeInput ? typeInput.value : 'yesno';
            const time = timeInput ? timeInput.value : 'morning';
            const frequency = freqInput ? freqInput.value : 'daily';
            if (!name.trim()) {
                showNotification('ë£¨í‹´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            if (!currentUser) {
                showNotification('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            let userFamilyId = familyId;
            if (!userFamilyId) {
                try {
                    const userDocRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/profile/data`);
                    const userDoc = await getDoc(userDocRef);
                    if (userDoc.exists()) {
                        userFamilyId = userDoc.data().familyId;
                        familyId = userFamilyId; // ì „ì—­ familyId ì—…ë°ì´íŠ¸
                    }
                } catch (error) {
                    console.error('âŒ familyId ì¡°íšŒ ì‹¤íŒ¨:', error);
                }
            }
            if (!userFamilyId) {
                showNotification('ê°€ì¡± ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            try {
                const routineCollectionRef = collection(db, `artifacts/${appId}/users/${currentUser.uid}/routines`);
                const routineData = {
                    name: name.trim(),
                    type: type,
                    time: time,
                    frequency: frequency,
                    order: Date.now(), // ìˆœì„œ ì§€ì •ì„ ìœ„í•´ íƒ€ì„ìŠ¤íƒ¬í”„ ì‚¬ìš©
                    userId: currentUser.uid,
                    familyId: userFamilyId,
                    createdAt: FieldValue.serverTimestamp()
                };
                const docRef = await addDoc(routineCollectionRef, routineData);
                console.log('âœ… Firestoreì— ì €ì¥ ì™„ë£Œ! ë¬¸ì„œ ID:', docRef.id);
                showNotification(`âœ¨ ìƒˆ ë£¨í‹´ "${name}"ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                closeModal();
                nameInput.value = '';
                // ê´€ë¦¬ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    loadUserRoutines();
                }, 500);
            } catch (error) {
                console.error('âŒ ë£¨í‹´ ì¶”ê°€ ì˜¤ë¥˜:', error);
                showNotification('ë£¨í‹´ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }
        // Make addRoutine globally accessible
        window.addRoutine = addRoutine;
        // ì‚¬ìš©ì ë£¨í‹´ ë¡œë“œ (ê´€ë¦¬ í˜ì´ì§€ìš©)
        async function loadUserRoutines() {
            if (!currentUser || !familyId) {
                console.log('âŒ ë£¨í‹´ ë¡œë“œ ì¡°ê±´ ë¶ˆì¶©ì¡±');
                return;
            }
            try {
                console.log('ğŸ“‹ ë£¨í‹´ ëª©ë¡ ë¡œë“œ ì‹œì‘...');
                const routinesQuery = query(
                    collection(db, `artifacts/${appId}/users/${currentUser.uid}/routines`),
                    where('familyId', '==', familyId)
                );
                const routinesSnapshot = await getDocs(routinesQuery);
                console.log('ğŸ“Š ì¡°íšŒëœ ë£¨í‹´ ìˆ˜:', routinesSnapshot.size);
                const manageList = document.getElementById('manageRoutineList');
                if (!manageList) {
                    console.error('âŒ ê´€ë¦¬ ëª©ë¡ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                manageList.innerHTML = '';
                if (routinesSnapshot.empty) {
                    manageList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“</div>
                            <div class="empty-state-title">ì•„ì§ ì¶”ê°€ëœ ë£¨í‹´ì´ ì—†ìŠµë‹ˆë‹¤</div>
                            <div class="empty-state-description">ìœ„ì˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ë²ˆì§¸ ë£¨í‹´ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</div>
                        </div>
                    `;
                    return;
                }
                // ì‹œê°„ ìˆœìœ¼ë¡œ ì •ë ¬ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì •ë ¬)
                const routines = [];
                routinesSnapshot.docs.forEach(doc => {
                    const data = doc.data();
                    routines.push({
                        id: doc.id,
                        ...data,
                        createdAt: data.createdAt?.toDate() || new Date()
                    });
                });
                routines.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());
                routines.forEach((routine, index) => {
                    const routineEl = document.createElement('div');
                    routineEl.className = 'routine-item';
                    routineEl.style.animationDelay = `${index * 0.1}s`;
                    const typeMap = {
                        'yesno': 'ì˜ˆ/ì•„ë‹ˆì˜¤',
                        'number': 'ìˆ«ì ì…ë ¥',
                        'time': 'ì‹œê°„ ì…ë ¥'
                    };
                    const timeMap = {
                        'morning': 'ğŸŒ… ì•„ì¹¨',
                        'afternoon': 'ğŸŒ ì ì‹¬',
                        'evening': 'ğŸŒ™ ì €ë…'
                    };
                    const freqMap = {
                        'daily': 'ë§¤ì¼',
                        'weekday': 'í‰ì¼',
                        'weekend': 'ì£¼ë§'
                    };
                    routineEl.innerHTML = `
                        <div class="routine-title">${routine.name}</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary); margin: 0.75rem 0;">
                            <span style="background: rgba(99, 102, 241, 0.1); color: var(--primary); padding: 0.25rem 0.5rem; border-radius: 0.5rem; margin-right: 0.5rem; font-weight: 600;">${typeMap[routine.type]}</span>
                            <span style="background: rgba(236, 72, 153, 0.1); color: var(--secondary); padding: 0.25rem 0.5rem; border-radius: 0.5rem; margin-right: 0.5rem; font-weight: 600;">${timeMap[routine.time]}</span>
                            <span style="background: rgba(16, 185, 129, 0.1); color: var(--success); padding: 0.25rem 0.5rem; border-radius: 0.5rem; font-weight: 600;">${freqMap[routine.frequency]}</span>
                        </div>
                        <div style="font-size: 0.75rem; color: var(--gray-400);">
                            ìƒì„±ì¼: ${routine.createdAt.toLocaleDateString('ko-KR')}
                        </div>
                    `;
                    manageList.appendChild(routineEl);
                });
                console.log('âœ… ë£¨í‹´ ëª©ë¡ ë Œë”ë§ ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ ë£¨í‹´ ë¡œë“œ ì˜¤ë¥˜:', error);
                const manageList = document.getElementById('manageRoutineList');
                if (manageList) {
                    manageList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">âš ï¸</div>
                            <div class="empty-state-title">ë£¨í‹´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>
                            <div class="empty-state-description">${error.message}</div>
                        </div>
                    `;
                }
            }
        }
        // ë£¨í‹´ í‘œì‹œ (í™ˆ í˜ì´ì§€ìš©)
        async function loadRoutinesForDisplay() {
            if (!currentUser || !familyId) {
                console.log('âŒ í™ˆ í˜ì´ì§€ ë£¨í‹´ ë¡œë“œ ì¡°ê±´ ë¶ˆì¶©ì¡±');
                return;
            }
            try {
                const routineListContainer = document.getElementById('routineList');
                routineListContainer.innerHTML = ''; // ê¸°ì¡´ ë£¨í‹´ ì´ˆê¸°í™”
                const routinesQuery = query(
                    collection(db, `artifacts/${appId}/users/${currentUser.uid}/routines`),
                    where('familyId', '==', familyId)
                );
                const routinesSnapshot = await getDocs(routinesQuery);
                if (routinesSnapshot.empty) {
                    routineListContainer.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">âœ¨</div>
                            <div class="empty-state-title">ì˜¤ëŠ˜ì˜ ë£¨í‹´ì´ ì—†ìŠµë‹ˆë‹¤</div>
                            <div class="empty-state-description">ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ìƒˆë¡œìš´ ë£¨í‹´ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</div>
                        </div>
                    `;
                    return;
                }
                const today = new Date().toISOString().split('T')[0];
                const routineLogsQuery = query(
                    collection(db, `artifacts/${appId}/users/${currentUser.uid}/routine_logs`),
                    where('userId', '==', currentUser.uid),
                    where('date', '==', today)
                );
                const logsSnapshot = await getDocs(routineLogsQuery);
                const todayLogs = {};
                logsSnapshot.forEach(doc => {
                    const logData = doc.data();
                    todayLogs[logData.routineId] = logData.value;
                });
                const routines = [];
                routinesSnapshot.docs.forEach(doc => {
                    routines.push({ id: doc.id, ...doc.data() });
                });
                // ë£¨í‹´ ìˆœì„œëŒ€ë¡œ ì •ë ¬ (order í•„ë“œ ì‚¬ìš©)
                routines.sort((a, b) => a.order - b.order);
                routines.forEach((routine, index) => {
                    const routineEl = document.createElement('div');
                    routineEl.className = 'routine-item';
                    routineEl.style.animationDelay = `${index * 0.1}s`;
                    let controlsHtml = '';
                    const currentValue = todayLogs[routine.id] || '';
                    if (routine.type === 'yesno') {
                        const yesActive = currentValue === 'yes' ? 'active' : '';
                        const noActive = currentValue === 'no' ? 'active' : '';
                        // ìˆ˜ì •ë¨: updateRoutine í˜¸ì¶œ ì‹œ event ì „ë‹¬
                        controlsHtml = `
                            <div class="yes-no-btns">
                                <button class="yes-btn ${yesActive}" onclick="window.updateRoutine('${routine.id}', 'yes', event)">âœ… ì™„ë£Œ</button>
                                <button class="no-btn ${noActive}" onclick="window.updateRoutine('${routine.id}', 'no', event)">âŒ ê±´ë„ˆë›°ê¸°</button>
                            </div>
                        `;
                    } else if (routine.type === 'number') {
                        // ìˆ˜ì •ë¨: updateRoutine í˜¸ì¶œ ì‹œ event ì „ë‹¬
                        controlsHtml = `
                            <input type="number" class="number-input" placeholder="ìˆ«ì ì…ë ¥" value="${currentValue}" onchange="window.updateRoutine('${routine.id}', this.value, event)">
                        `;
                    } else if (routine.type === 'time') {
                        // ìˆ˜ì •ë¨: updateRoutine í˜¸ì¶œ ì‹œ event ì „ë‹¬
                        controlsHtml = `
                            <input type="time" class="time-input" value="${currentValue}" onchange="window.updateRoutine('${routine.id}', this.value, event)">
                        `;
                    }
                    routineEl.innerHTML = `
                        <div class="routine-title">${routine.name}</div>
                        <div class="routine-controls">
                            ${controlsHtml}
                        </div>
                    `;
                    routineListContainer.appendChild(routineEl);
                });
            } catch (error) {
                console.error('âŒ í™ˆ í˜ì´ì§€ ë£¨í‹´ ë¡œë“œ ì˜¤ë¥˜:', error);
                const routineListContainer = document.getElementById('routineList');
                if (routineListContainer) {
                    routineListContainer.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">âš ï¸</div>
                            <div class="empty-state-title">ë£¨í‹´ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>
                            <div class="empty-state-description">${error.message}</div>
                        </div>
                    `;
                }
            }
        }
        // ì‚¬ìš©ì í”„ë¡œí•„ ë¡œë“œ ë° UI ì—…ë°ì´íŠ¸
        async function loadUserProfile() {
            console.log('ğŸ‘¤ ì‚¬ìš©ì í”„ë¡œí•„ ë¡œë“œ ì‹œì‘');
            try {
                const userDocRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/profile/data`);
                const userDoc = await getDoc(userDocRef);
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userRole = userData.role;
                    familyId = userData.familyId;
                    console.log('ğŸ‘¤ ì‚¬ìš©ì ë°ì´í„°:', userData);
                    console.log('ğŸ”‘ ê°€ì¡± ID:', familyId);
                    console.log('ğŸ‘¥ ì‚¬ìš©ì ì—­í• :', userRole);
                    const displayName = userData.displayName || currentUser.displayName || currentUser.email.split('@')[0];
                    const userEmailEl = document.getElementById('userEmail');
                    const userRoleEl = document.getElementById('userRole');
                    const currentUserIdEl = document.getElementById('currentUserId'); // userId ì—˜ë¦¬ë¨¼íŠ¸
                    if (userEmailEl) userEmailEl.textContent = displayName;
                    if (userRoleEl) userRoleEl.textContent = userRole === 'parent' ? 'ë¶€ëª¨' : 'ìë…€';
                    if (currentUserIdEl) currentUserIdEl.textContent = `ID: ${currentUser.uid}`; // userId í‘œì‹œ
                    // ë¶€ëª¨ì¸ ê²½ìš° ê°€ì¡± ì½”ë“œ í™•ì¸
                    if (userRole === 'parent' && familyId) {
                        console.log('ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ë¶€ëª¨ ê³„ì • - ê°€ì¡± ì½”ë“œ ì°¾ëŠ” ì¤‘...');
                        const familyDocRef = doc(db, `artifacts/${appId}/public/data/families/${familyId}`);
                        const familyDoc = await getDoc(familyDocRef);
                        if (familyDoc.exists()) {
                            const familyData = familyDoc.data();
                            const familyCode = familyData.familyCode || familyId;
                            console.log('ğŸ”‘ ê°€ì¡± ì½”ë“œ ë°œê²¬:', familyCode);
                            const codeElement = document.getElementById('generatedFamilyCode');
                            const displayElement = document.getElementById('familyCodeDisplay');
                            if (codeElement && displayElement) {
                                codeElement.textContent = familyCode;
                                displayElement.classList.remove('hidden');
                                displayElement.style.display = 'block';
                                console.log('âœ… ê°€ì¡± ì½”ë“œ í‘œì‹œ ì™„ë£Œ!');
                                showNotification(`ğŸ”‘ ê°€ì¡± ì½”ë“œ: ${familyCode} (ìë…€ì—ê²Œ ê³µìœ í•˜ì„¸ìš”!)`);
                            }
                        }
                    }
                    if (familyId) {
                        console.log('âœ… familyId ì„¤ì • ì™„ë£Œ:', familyId);
                    } else {
                        console.error('âŒ familyIdê°€ ì—¬ì „íˆ nullì…ë‹ˆë‹¤!');
                    }
                    showNotification(`ì•ˆë…•í•˜ì„¸ìš”, ${displayName}ë‹˜! ğŸ‘‹`);
                } else {
                    console.log('âŒ ì‚¬ìš©ì ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('âŒ í”„ë¡œí•„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        function startRealtimeListeners() {
            console.log('ğŸ”„ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì‹œì‘');
            // í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ ë£¨í‹´ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¡œë“œ
            if (currentUser && familyId) {
                const routinesCollectionRef = collection(db, `artifacts/${appId}/users/${currentUser.uid}/routines`);
                const q = query(routinesCollectionRef, where('familyId', '==', familyId));
                onSnapshot(q, (snapshot) => {
                    console.log('ğŸ”„ ë£¨í‹´ ë°ì´í„° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ê°ì§€!');
                    // í™ˆ í˜ì´ì§€ê°€ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œë§Œ ì—…ë°ì´íŠ¸
                    if (document.getElementById('homePage').style.display === 'block') {
                        loadRoutinesForDisplay();
                    }
                    // ê´€ë¦¬ í˜ì´ì§€ê°€ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œë§Œ ì—…ë°ì´íŠ¸
                    if (document.getElementById('managePage').style.display === 'block') {
                        loadUserRoutines();
                    }
                }, (error) => {
                    console.error("Error listening to routines: ", error);
                    showNotification("ë£¨í‹´ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜: " + error.message, 'error');
                });
                // ê°€ì¡± êµ¬ì„±ì› ì •ë³´ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (ë¶€ëª¨ìš©)
                if (userRole === 'parent') {
                    const familyDocRef = doc(db, `artifacts/${appId}/public/data/families/${familyId}`);
                    onSnapshot(familyDocRef, (docSnapshot) => {
                        if (docSnapshot.exists()) {
                            console.log('ğŸ”„ ê°€ì¡± ë©¤ë²„ ë°ì´í„° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ê°ì§€!');
                            if (document.getElementById('familyPage').style.display === 'block') {
                                loadFamilyPageInfo(); // ê°€ì¡± í˜ì´ì§€ ì •ë³´ ë° ë©¤ë²„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                            }
                        }
                    }, (error) => {
                        console.error("Error listening to family members: ", error);
                        showNotification("ê°€ì¡± ë©¤ë²„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜: " + error.message, 'error');
                    });
                }
            }
        }
        // ëª¨ë‹¬ ê´€ë ¨
        function openAddRoutineModal() {
            const modal = document.getElementById('addRoutineModal');
            modal.style.display = 'block';
            // ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜
            setTimeout(() => {
                const modalContent = modal.querySelector('.modal-content');
                if (modalContent) {
                    modalContent.style.animation = 'fadeInUp 0.3s ease-out';
                }
            }, 10);
        }
        // Make openAddRoutineModal globally accessible
        window.openAddRoutineModal = openAddRoutineModal;
        function closeModal() {
            const modal = document.getElementById('addRoutineModal');
            const modalContent = modal.querySelector('.modal-content');
            if (modalContent) {
                modalContent.style.animation = 'fadeInUp 0.3s ease-out reverse';
            }
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
        // Make closeModal globally accessible
        window.closeModal = closeModal;
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('addRoutineModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        // ë¡œê·¸ì•„ì›ƒ
        async function logout() {
            try {
                await signOut(auth);
                showNotification('ğŸ‘‹ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                showNotification('ë¡œê·¸ì•„ì›ƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        // Make logout globally accessible
        window.logout = logout;
        // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ì— ë¦¬í”Œ íš¨ê³¼ ì¶”ê°€
        document.addEventListener('DOMContentLoaded', function() {
            document.addEventListener('click', function(e) {
                if (e.target.matches('.btn') || e.target.matches('.yes-btn') || e.target.matches('.no-btn') || e.target.matches('.role-btn') || e.target.matches('.nav-item')) {
                    addRippleEffect(e.target, e);
                }
            });
        });
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ DOM ë¡œë“œ ì™„ë£Œ');
            updateCurrentDate();
            updateDailyQuote();
            // Firebase ì´ˆê¸°í™” ì‹œë„
            // Canvas í™˜ê²½ì—ì„œ __app_id, __firebase_config, __initial_auth_tokenì´ ë¡œë“œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
            const checkFirebaseGlobals = setInterval(() => {
                if (typeof __app_id !== 'undefined' && typeof __firebase_config !== 'undefined' && typeof __initial_auth_token !== 'undefined') {
                    clearInterval(checkFirebaseGlobals);
                    initializeFirebase();
                } else {
                    console.log('â³ Firebase ì „ì—­ ë³€ìˆ˜ ë¡œë“œ ëŒ€ê¸° ì¤‘...');
                }
            }, 100);
        });
        // ì¶”ê°€ ìŠ¤íƒ€ì¼ - ë¦¬í”Œ íš¨ê³¼
        const style = document.createElement('style');
        style.textContent = `
            .ripple {
                position: absolute;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.6);
                transform: scale(0);
                animation: ripple 0.6s ease-out;
                pointer-events: none;
            }
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
            @keyframes slideOutRight {
                from {
                    opacity: 1;
                    transform: translateX(0);
                }
                to {
                    opacity: 0;
                    transform: translateX(100%);
                }
            }
            /* ì¶”ê°€ í˜¸ë²„ íš¨ê³¼ */
            .routine-item:hover .routine-title {
                color: var(--primary);
                transition: color 0.3s ease;
            }
            .member-card:hover .member-name {
                color: var(--primary);
                transition: color 0.3s ease;
            }
            /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
            ::-webkit-scrollbar {
                width: 6px;
            }
            ::-webkit-scrollbar-track {
                background: var(--gray-100);
                border-radius: 3px;
            }
            ::-webkit-scrollbar-thumb {
                background: var(--gray-300);
                border-radius: 3px;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: var(--gray-400);
            }
            /* í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼ ê°œì„  */
            input:focus, select:focus, button:focus {
                outline: 2px solid var(--primary);
                outline-offset: 2px;
            }
            /* í„°ì¹˜ í”¼ë“œë°± */
            .btn:active,
            .nav-item:active,
            .role-btn:active {
                transform: scale(0.98);
            }
            /* ë¡œë”© ìƒíƒœ ê°œì„  */
            .btn:disabled {
                background: var(--gray-300);
                cursor: not-allowed;
                transform: none;
                opacity: 0.7;
            }
            /* ì„±ê³µ/ì˜¤ë¥˜ ìƒíƒœ */
            .input-success {
                border-color: var(--success) !important;
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1) !important;
            }
            .input-error {
                border-color: var(--error) !important;
                box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
            }
            /* ë¹ˆ ìƒíƒœ ê°œì„  */
            .empty-state {
                text-align: center;
                padding: 3rem 1rem;
                color: var(--text-secondary);
            }
            .empty-state-icon {
                font-size: 4rem;
                margin-bottom: 1rem;
                opacity: 0.5;
            }
            .empty-state-title {
                font-size: 1.25rem;
                font-weight: 600;
                margin-bottom: 0.5rem;
                color: var(--text-primary);
            }
            .empty-state-description {
                font-size: 0.875rem;
                max-width: 300px;
                margin: 0 auto;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>