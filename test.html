<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth ìµœì¢… í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: sans-serif; padding: 2rem; background-color: #111827; color: #f3f4f6; }
        #status { font-size: 1.2rem; font-weight: bold; margin-bottom: 1rem; }
        #login-btn, #logout-btn { padding: 1rem; font-size: 1rem; cursor: pointer; }
        .success { color: #22c55e; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <h1>Firebase ì¸ì¦ ê¸°ëŠ¥ ìµœì¢… ì‹¬ë¬¸</h1>
    <p>ì´ í˜ì´ì§€ëŠ” ì˜¤ì§ Firebase Auth ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ì´í° í™˜ê²½ì—ì„œ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.</p>
    <hr style="margin: 1rem 0;">

    <div id="status">ìƒíƒœ: í™•ì¸ ì¤‘...</div>
    <button id="login-btn" style="display: none;">Google ë¡œê·¸ì¸</button>
    <button id="logout-btn" style="display: none;">ë¡œê·¸ì•„ì›ƒ</button>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script>
        // --- 1. Firebase ì´ˆê¸°í™” (ì‚¬ë ¹ê´€ë‹˜ì˜ ì„¤ì •ìœ¼ë¡œ êµì²´í•´ì£¼ì„¸ìš”) ---
        const firebaseConfig = {
            apiKey: "AIzaSyC6bvEaHsxpLtPv5zM99PmgAwOnRXnhkBM",
            authDomain: "habit-dc62a.firebaseapp.com",
            projectId: "habit-dc62a",
            storageBucket: "habit-dc62a.firebasestorage.app",
            messagingSenderId: "668374525477",
            appId: "1:668374525477:web:ecbecd95ec631fb82cc1cc",
            measurementId: "G-DV5Z9YVTZG"
        };
        firebase.initializeApp(firebaseConfig);
        console.log("âœ… Firebase App ì´ˆê¸°í™” ì™„ë£Œ.");

        // --- 2. ë³€ìˆ˜ ë° UI ìš”ì†Œ ---
        const statusDiv = document.getElementById('status');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const provider = new firebase.auth.GoogleAuthProvider();

        // --- 3. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        loginBtn.addEventListener('click', () => {
            statusDiv.className = 'info';
            statusDiv.textContent = 'Google ë¡œê·¸ì¸ ì‹œë„ ì¤‘...';
            firebase.auth().signInWithRedirect(provider);
        });

        logoutBtn.addEventListener('click', () => {
            firebase.auth().signOut();
        });

        // --- 4. í•µì‹¬ ì‹¬ë¬¸: onAuthStateChanged ---
        console.log("â³ onAuthStateChanged ê°ì‹œì ë°°ì¹˜ë¥¼ ì‹œë„í•©ë‹ˆë‹¤...");
        try {
            firebase.auth().onAuthStateChanged(user => {
                console.log("ğŸ‰ onAuthStateChangedê°€ ì„±ê³µì ìœ¼ë¡œ ë°œë™ë˜ì—ˆìŠµë‹ˆë‹¤!");
                if (user) {
                    // ë¡œê·¸ì¸ ì„±ê³µ
                    statusDiv.className = 'success';
                    statusDiv.textContent = `ë¡œê·¸ì¸ ì„±ê³µ: ${user.displayName} (${user.uid})`;
                    loginBtn.style.display = 'none';
                    logoutBtn.style.display = 'inline-block';
                    console.log("ì‚¬ìš©ì ì •ë³´:", user);
                } else {
                    // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
                    statusDiv.className = 'error';
                    statusDiv.textContent = 'ìƒíƒœ: ë¡œê·¸ì•„ì›ƒë¨';
                    loginBtn.style.display = 'inline-block';
                    logoutBtn.style.display = 'none';
                    console.log("ì‚¬ìš©ì ì—†ìŒ (ë¡œê·¸ì•„ì›ƒ ìƒíƒœ).");
                }
            });
            console.log("âœ… onAuthStateChanged ê°ì‹œì ë°°ì¹˜ê°€ ì˜¤ë¥˜ ì—†ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch (error) {
            console.error("ğŸ’£ CRITICAL: onAuthStateChanged ë°°ì¹˜ ì¤‘ ì¹˜ëª…ì  ì˜¤ë¥˜ ë°œìƒ!", error);
            statusDiv.className = 'error';
            statusDiv.textContent = 'ì¹˜ëª…ì  ì˜¤ë¥˜ ë°œìƒ! ì½˜ì†”ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤.';
        }
        
        // --- 5. ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²°ê³¼ ì²˜ë¦¬ ---
        firebase.auth().getRedirectResult()
          .catch(error => console.error("getRedirectResult ì˜¤ë¥˜:", error));

    </script>
</body>
</html>